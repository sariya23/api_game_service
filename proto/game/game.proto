syntax = "proto3";

package game;
option go_package = "github.com/sariya23/api_game_service/gen/game;game";


import "google/api/annotations.proto";
import "google/api/date.proto";
import "common/enums.proto";
import "validate/validate.proto";


service GameService {
  // Создать новую игру
  rpc AddGame(AddGameRequest) returns (AddGameResponse) {
    option (google.api.http) = {
      post: "/v1/games"
      body: "*"
    };
  };

  // Получить игру с подробной информацией
  rpc GetGame(GetGameRequest) returns (GetGameResponse) {
    option (google.api.http) = {
      get: "/v1/games/{game_id}"
    };
  };

  // Получить список игр с укороченной информацией
  rpc GameList(GameListRequest) returns (GameListResponse) {
    option (google.api.http) = {
      post: "/v1/games/list"
      body: "*"
    };
  };

  // GetTags получить тэги игр
  rpc GetTags(GetTagsRequest) returns (GetTagsResponse) {
    option (google.api.http) = {
      get: "/v1/games/tags"
    };
  };

  // GetGenres получить жанры игр
  rpc GetGenres(GetGenresRequest) returns (GetGenresResponse) {
    option (google.api.http) = {
      get: "/v1/games/genres"
    };
  };

  // UpdateGame обновить игру
  rpc UpdateGame(UpdateGameRequest) returns (UpdateGameResponse) {
    option (google.api.http) = {
      put: "/v1/games/update"
      body: "*"
    };
  };

  // GameListByCreator отдает список игр, фильтруя по создателю
  rpc GameListByCreator(GameListByCreatorRequest) returns (GameListByCreatorResponse) {
    option (google.api.http) = {
      post: "/v1/games/creator"
      body: "*"
    };
  }

  // GameListMy отдает список игр, которые создал пользователь
  rpc GameListMy(GameListMyRequest) returns (GameListMyResponse) {
    option (google.api.http) = {
      post: "/v1/games/my"
      body: "*"
    };
  }
}

message GameRequest {
  string title = 1 [(validate.rules).string.min_len = 1];
  repeated string genres = 2 [(validate.rules).repeated.min_items = 1];
  string description = 3 [(validate.rules).string.min_len = 1];
  google.type.Date release_date = 4 [(validate.rules).any.required=true];
  bytes cover_image = 5 [(validate.rules).bytes.min_len = 1];
  repeated string tags = 6 [(validate.rules).repeated.min_items = 1];
}

message AddGameRequest {
  GameRequest game = 1;
}

message AddGameResponse {
  int64 game_id = 1;
}

message GetGameRequest {
  int64 game_id = 1;
}

message GetGameResponse {
  Game game = 1;
  message Game {
    string title = 1;
    repeated string genres = 2;
    string description = 3;
    google.type.Date release_date = 4;
    string cover_image_url = 5;
    repeated string tags = 6;
    int64 ID = 7;
    string creator_id = 8;
  }
}

message GameListRequest {
  reserved 1;
  reserved "year";
  uint32 limit = 2;
  repeated string genres = 3;
  repeated string tags = 4;
  uint32 offset = 5;
  repeated int32 years = 6;
}

message GameListResponse {
  repeated ShortGame games = 1;

  message ShortGame {
    int64 ID = 1;
    string title = 2;
    string description = 3;
    google.type.Date release_date = 4;
    string cover_image_url = 5;
  }
}

message GetTagsRequest {}

message GetTagsResponse {
  repeated string tags = 1;
}

message GetGenresRequest {}

message GetGenresResponse {
  repeated string genres = 1;
}

message UpdateGameRequest {
  int64 game_id = 1;
  Game game = 2;
  message Game {
    string title = 1 [(validate.rules).string.min_len = 1];
    repeated string genres = 2 [(validate.rules).repeated.min_items = 1];
    string description = 3 [(validate.rules).string.min_len = 1];
    google.type.Date release_date = 4 [(validate.rules).any.required=true];
    bytes cover_image = 5 [(validate.rules).bytes.min_len = 1];
    repeated string tags = 6 [(validate.rules).repeated.min_items = 1];
  }
}

message UpdateGameResponse {}

message GameListByCreatorRequest {
  string creator_id = 1 [(validate.rules).string.min_len = 1];
  Pagination pagination = 2;
  message Pagination {
    uint32 limit = 2;
    uint32 offset = 3;
  }
}

message GameListByCreatorResponse {
    repeated Games games = 1;
    message Games {
      int64 game_id = 1;
      string title = 2;
      string cover_image_url = 5;
    }
    int64 total = 2;
}

message GameListMyRequest {
  repeated common.GameStatusType statuses = 1;
  Pagination pagination = 2;
  message Pagination {
    uint32 limit = 2;
    uint32 offset = 3;
  }
}

message GameListMyResponse {
  repeated Games games = 1;
  message Games {
    int64 game_id = 1;
    string title = 2;
    string cover_image_url = 5;
  }
  int64 total = 2;
}